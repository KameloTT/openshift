oc patch cm/argocd-cm -p '{"data":{"resource.customizations.health.operators.coreos.com_Subscription":"health_status = {}\n\nif obj.status ~= nil then\n  if obj.status.conditions ~= nil then\n    numDegraded = 0\n    numPending = 0\n    msg = \"\"\n    currentcsv = obj.status.currentCSV\n    if obj.status.installedCSV ~= nil then\n      installedcsv = obj.status.installedCSV\n    else\n      installedcsv = currentcsv\n    end\n    for i, condition in pairs(obj.status.conditions) do\n      msg = msg .. i .. \":\" .. condition.type .. \" | \" .. condition.status .. \"\\n\"\n      if condition.type == \"InstallPlanPending\" and condition.status == \"True\" and installedcsv == currentcsv then\n        numPending = numPending + 1\n      elseif ( ( condition.type == \"CatalogSourcesUnhealthy\" and installedcsv == currentcsv ) or condition.type == \"InstallPlanMissing\" or condition.type == \"InstallPlanFailed\" or condition.type == \"ResolutionFailed\") and condition.status == \"True\" then\n        numDegraded = numDegraded + 1\n      end\n    end\n    if numDegraded == 0 and numPending == 0 then\n      health_status.status = \"Healthy\"\n      health_status.message = msg\n      return health_status\n    elseif numPending \u003e 0 and numDegraded == 0 then\n      health_status.status = \"Progressing\"\n      health_status.message = \"An install plan for a subscription is pending installation\"\n      return health_status\n    else\n      health_status.status = \"Degraded\"\n      health_status.message = msg\n      return health_status\n    end\n  end\nend\n\nhealth_status.status = \"Progressing\"\n\nhealth_status.message = \"An install plan for a subscription is pending installation\"\n\nreturn health_status\n","resource.customizations.useOpenLibs.operators.coreos.com_Subscription":"true"}}'
